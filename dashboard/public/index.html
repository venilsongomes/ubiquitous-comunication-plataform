<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Completo - Plataforma de ComunicaÃ§Ã£o UbÃ­qua</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #555;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .status-grid {
            display: grid;
            gap: 10px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .status-item strong {
            color: #333;
            flex: 1;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .status-running {
            background: #d4edda;
            color: #155724;
        }

        .status-stopped {
            background: #f8d7da;
            color: #721c24;
        }

        .status-online {
            background: #d1ecf1;
            color: #0c5460;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.95em;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Courier New', monospace;
            background: #f9f9f9;
        }

        .logs-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.5;
            word-break: break-all;
        }

        .message-thread {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .message {
            background: white;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 3px;
            border-left: 3px solid #667eea;
        }

        .message.sent {
            border-left-color: #28a745;
        }

        .message.received {
            border-left-color: #17a2b8;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .two-column {
            grid-column: span 2;
        }

        .metric {
            display: inline-block;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 5px;
            text-align: center;
            min-width: 150px;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .two-column {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ Dashboard Completo - Plataforma UbÃ­qua</h1>
            <p>Gerencie todas as funcionalidades da sua plataforma distribuÃ­da</p>
        </header>

        <!-- Abas de NavegaÃ§Ã£o -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('infrastructure')">ğŸ“Š Infraestrutura</button>
            <button class="tab-btn" onclick="switchTab('auth')">ğŸ” AutenticaÃ§Ã£o</button>
            <button class="tab-btn" onclick="switchTab('messaging')">ğŸ’¬ Mensageria</button>
            <button class="tab-btn" onclick="switchTab('presence')">ğŸ“ PresenÃ§a</button>
            <button class="tab-btn" onclick="switchTab('storage')">ğŸ“ Armazenamento</button>
            <button class="tab-btn" onclick="switchTab('telegram')">ğŸ“± Telegram</button>
            <button class="tab-btn" onclick="switchTab('monitoring')">ğŸ“Š Monitoramento</button>
            <button class="tab-btn" onclick="switchTab('advanced')">âš™ï¸ AvanÃ§ado</button>
        </div>

        <!-- TAB 1: INFRAESTRUTURA -->
        <div id="infrastructure" class="tab-content active">
            <div class="dashboard-grid">
                <!-- Docker Status -->
                <div class="card full-width">
                    <h2>ğŸ“Š Status dos Containers Docker</h2>
                    <div id="alert-docker"></div>
                    <div class="button-group">
                        <button class="btn-info" onclick="getDockerStatus()">ğŸ”„ Atualizar</button>
                        <button class="btn-success" onclick="startContainers()">â–¶ï¸ Iniciar Todos</button>
                        <button class="btn-danger" onclick="stopContainers()">â¹ï¸ Parar Todos</button>
                    </div>
                    <div id="docker-status" class="status-grid"></div>
                </div>

                <!-- Kafka Status -->
                <div class="card">
                    <h2>ğŸ”— Apache Kafka</h2>
                    <div id="alert-kafka"></div>
                    <div class="button-group">
                        <button class="btn-info" onclick="checkKafka()">âœ… Verificar Status</button>
                        <button class="btn-primary" onclick="listKafkaTopics()">ğŸ“‹ Listar TÃ³picos</button>
                    </div>
                    <textarea id="kafka-status" readonly placeholder="Status do Kafka..."></textarea>
                </div>

                <!-- Redis Status -->
                <div class="card">
                    <h2>âš¡ Redis Cache</h2>
                    <div id="alert-redis"></div>
                    <div class="button-group">
                        <button class="btn-info" onclick="checkRedis()">âœ… Verificar Status</button>
                        <button class="btn-primary" onclick="getRedisInfo()">ğŸ“Š InformaÃ§Ãµes</button>
                    </div>
                    <textarea id="redis-status" readonly placeholder="Status do Redis..."></textarea>
                </div>

                <!-- Database Status -->
                <div class="card">
                    <h2>ğŸ—„ï¸ PostgreSQL</h2>
                    <div id="alert-database"></div>
                    <div class="button-group">
                        <button class="btn-info" onclick="checkDatabase()">âœ… Verificar Status</button>
                        <button class="btn-primary" onclick="getDatabaseInfo()">ğŸ“Š InformaÃ§Ãµes</button>
                    </div>
                    <textarea id="database-status" readonly placeholder="Status do PostgreSQL..."></textarea>
                </div>
            </div>
        </div>

        <!-- TAB 2: AUTENTICAÃ‡ÃƒO -->
        <div id="auth" class="tab-content">
            <div class="dashboard-grid">
                <div class="card full-width">
                    <h2>ğŸ” Sistema de AutenticaÃ§Ã£o JWT</h2>
                    <div id="alert-auth"></div>

                    <h3>ğŸ‘¤ Criar Novo UsuÃ¡rio</h3>
                    <input type="text" id="reg-username" placeholder="Nome de usuÃ¡rio" value="user">
                    <input type="email" id="reg-email" placeholder="Email" value="user@example.com">
                    <input type="password" id="reg-password" placeholder="Senha" value="Senha123!">
                    <input type="password" id="reg-password-confirm" placeholder="Confirmar Senha" value="Senha123!">
                    <button class="btn-success" onclick="registerUser()">ğŸ“ Registrar</button>

                    <h3 style="margin-top: 20px;">ğŸ”‘ Fazer Login</h3>
                    <input type="text" id="login-username" placeholder="Nome de usuÃ¡rio" value="user">
                    <input type="password" id="login-password" placeholder="Senha" value="Senha123!">
                    <div class="button-group">
                        <button class="btn-primary" onclick="loginUser()">ğŸ”“ Login</button>
                        <button class="btn-secondary" onclick="logoutUser()">ğŸšª Logout</button>
                    </div>

                    <h3>ğŸ“‹ Token JWT</h3>
                    <textarea id="token-display" readonly placeholder="Token JWT serÃ¡ exibido aqui..."></textarea>
                    <button class="btn-info" onclick="copyToken()">ğŸ“‹ Copiar Token</button>

                    <h3 style="margin-top: 20px;">ğŸ” Validar Token</h3>
                    <div class="button-group">
                        <button class="btn-info" onclick="validateToken()">âœ… Validar Token Atual</button>
                    </div>
                    <textarea id="token-validation" readonly placeholder="Resultado da validaÃ§Ã£o..."></textarea>
                </div>
            </div>
        </div>

        <!-- TAB 3: MENSAGERIA -->
        <div id="messaging" class="tab-content">
            <div class="dashboard-grid">
                <div class="card full-width">
                    <h2>ğŸ’¬ Sistema de Mensageria em Tempo Real</h2>
                    <div id="alert-messaging"></div>

                    <h3>ğŸ“¤ Enviar Mensagem</h3>
                    <input type="text" id="msg-conversation-id" placeholder="ID da Conversa (UUID)">
                    <select id="msg-type" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 10px;">
                        <option value="text">ğŸ“ Texto</option>
                        <option value="image">ğŸ–¼ï¸ Imagem</option>
                        <option value="video">ğŸ¥ VÃ­deo</option>
                        <option value="file">ğŸ“„ Arquivo</option>
                        <option value="location">ğŸ“ LocalizaÃ§Ã£o</option>
                    </select>
                    <textarea id="msg-content" placeholder="ConteÃºdo da mensagem...">OlÃ¡! Esta Ã© uma mensagem de teste.</textarea>
                    <div class="button-group">
                        <button class="btn-success" onclick="sendMessage()">ğŸ“¤ Enviar</button>
                        <button class="btn-info" onclick="generateConversationId()">ğŸ”„ Gerar ID</button>
                        <button class="btn-info" onclick="connectWebSocket()">ğŸ”Œ Conectar WebSocket</button>
                        <button class="btn-danger" onclick="disconnectWebSocket()">âŒ Desconectar</button>
                    </div>

                    <h3>ğŸ” HistÃ³rico de Mensagens</h3>
                    <div class="message-thread" id="message-thread"></div>

                    <h3>ğŸ“¡ Status da ConexÃ£o</h3>
                    <div id="websocket-status" class="status-item" style="display: flex; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <strong>WebSocket:</strong>
                        <span class="status-badge status-stopped" id="ws-status">Desconectado</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: PRESENÃ‡A -->
        <div id="presence" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2>ğŸ“ Gerenciar PresenÃ§a (ONLINE/OFFLINE)</h2>
                    <div id="alert-presence"></div>

                    <h3>ğŸ‘¤ Sua PresenÃ§a</h3>
                    <div class="status-item">
                        <strong>Status Atual:</strong>
                        <span class="status-badge status-online" id="my-presence">Offline</span>
                    </div>

                    <div class="button-group">
                        <button class="btn-success" onclick="goOnline()">ğŸŸ¢ Online</button>
                        <button class="btn-danger" onclick="goOffline()">ğŸ”´ Offline</button>
                    </div>

                    <h3>ğŸ” Verificar PresenÃ§a de Outro UsuÃ¡rio</h3>
                    <input type="text" id="presence-user-id" placeholder="ID do UsuÃ¡rio (UUID)">
                    <button class="btn-info" onclick="checkUserPresence()">ğŸ” Verificar</button>
                    <textarea id="presence-result" readonly placeholder="Resultado..."></textarea>
                </div>

                <div class="card">
                    <h2>ğŸ‘¥ UsuÃ¡rios Online</h2>
                    <div id="alert-users"></div>
                    <button class="btn-info" onclick="getOnlineUsers()">ğŸ”„ Atualizar Lista</button>
                    <div id="online-users" class="status-grid"></div>
                </div>
            </div>
        </div>

        <!-- TAB 5: ARMAZENAMENTO -->
        <div id="storage" class="tab-content">
            <div class="dashboard-grid">
                <div class="card full-width">
                    <h2>ğŸ“ Upload de Arquivos (S3/MinIO)</h2>
                    <div id="alert-storage"></div>

                    <h3>ğŸ“¤ 3 Passos para Upload</h3>
                    <input type="text" id="upload-filename" placeholder="Nome do arquivo" value="documento.pdf">
                    <input type="text" id="upload-mimetype" placeholder="MIME Type" value="application/pdf">
                    <textarea id="upload-content" placeholder="ConteÃºdo (ou deixe em branco para arquivo externo)" style="min-height: 60px;">Este Ã© um teste de upload.</textarea>

                    <div class="button-group">
                        <button class="btn-info" onclick="initiateUpload()">1ï¸âƒ£ Iniciar Upload</button>
                        <button class="btn-info" onclick="uploadFile()">2ï¸âƒ£ Enviar Arquivo</button>
                        <button class="btn-success" onclick="completeUpload()">3ï¸âƒ£ Completar</button>
                    </div>

                    <h3>ğŸ“Š Resultado do Upload</h3>
                    <textarea id="upload-result" readonly placeholder="Resultado do upload..."></textarea>

                    <h3 style="margin-top: 20px;">ğŸ”— Acessar MinIO</h3>
                    <div class="button-group">
                        <button class="btn-secondary" onclick="window.open('http://localhost:9001', '_blank')">ğŸŒ MinIO Console</button>
                        <button class="btn-info" onclick="listBuckets()">ğŸ“‹ Listar Buckets</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 6: TELEGRAM -->
        <div id="telegram" class="tab-content">
            <div class="dashboard-grid">
                <div class="card full-width">
                    <h2>ğŸ“± IntegraÃ§Ã£o Telegram</h2>
                    <div id="alert-telegram"></div>

                    <h3>âš™ï¸ ConfiguraÃ§Ã£o</h3>
                    <input type="text" id="telegram-token" placeholder="Token do Bot Telegram" value="YOUR_BOT_TOKEN_HERE">
                    <input type="text" id="telegram-chat-id" placeholder="ID do Chat/UsuÃ¡rio" value="YOUR_CHAT_ID_HERE">
                    <button class="btn-primary" onclick="saveTelegramConfig()">ğŸ’¾ Salvar ConfiguraÃ§Ã£o</button>

                    <h3 style="margin-top: 20px;">ğŸ“¤ Enviar Mensagem</h3>
                    <textarea id="telegram-message" placeholder="Mensagem para Telegram...">OlÃ¡ do Dashboard!</textarea>
                    <div class="button-group">
                        <button class="btn-success" onclick="sendTelegramMessage()">ğŸ“¤ Enviar</button>
                        <button class="btn-info" onclick="testTelegramConnection()">ğŸ”Œ Testar ConexÃ£o</button>
                    </div>

                    <h3>ğŸ“¨ Receber Mensagens</h3>
                    <button class="btn-info" onclick="startTelegramListener()">ğŸ‘‚ Iniciar Listener</button>
                    <button class="btn-danger" onclick="stopTelegramListener()">â¹ï¸ Parar Listener</button>
                    <div id="telegram-messages" class="message-thread"></div>

                    <h3 style="margin-top: 20px;">â„¹ï¸ Status</h3>
                    <textarea id="telegram-status" readonly placeholder="Status da conexÃ£o..."></textarea>
                </div>
            </div>
        </div>

        <!-- TAB 7: MONITORAMENTO -->
        <div id="monitoring" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2>ğŸ“Š Prometheus</h2>
                    <p>MÃ©tricas de Performance e Health Check</p>
                    <button class="btn-secondary" onclick="window.open('http://localhost:9090', '_blank')">ğŸŒ Prometheus UI</button>
                    <button class="btn-info" onclick="getPrometheusMetrics()">ğŸ“Š Carregar MÃ©tricas</button>
                    <textarea id="prometheus-metrics" readonly placeholder="MÃ©tricas..."></textarea>
                </div>

                <div class="card">
                    <h2>ğŸ“ˆ Grafana</h2>
                    <p>Dashboards Visuais e Alertas</p>
                    <button class="btn-secondary" onclick="window.open('http://localhost:3000', '_blank')">ğŸŒ Grafana UI</button>
                    <button class="btn-info" onclick="getGrafanaHealth()">â¤ï¸ Verificar SaÃºde</button>
                    <textarea id="grafana-status" readonly placeholder="Status do Grafana..."></textarea>
                </div>

                <div class="card full-width">
                    <h2>ğŸ“‰ MÃ©tricas da AplicaÃ§Ã£o</h2>
                    <button class="btn-info" onclick="getApplicationMetrics()">ğŸ”„ Atualizar MÃ©tricas</button>
                    <div id="app-metrics"></div>
                </div>
            </div>
        </div>

        <!-- TAB 8: AVANÃ‡ADO -->
        <div id="advanced" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2>ğŸ“œ Logs em Tempo Real</h2>
                    <div class="button-group">
                        <button class="btn-info" onclick="getLogs(50)">50 linhas</button>
                        <button class="btn-info" onclick="getLogs(100)">100 linhas</button>
                        <button class="btn-info" onclick="getLogs(200)">200 linhas</button>
                    </div>
                    <div id="logs-display" class="logs-container">Clique para carregar logs...</div>
                </div>

                <div class="card">
                    <h2>âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas</h2>
                    <h3>ğŸ”§ OperaÃ§Ãµes do Sistema</h3>
                    <div class="button-group">
                        <button class="btn-info" onclick="restartApp()">ğŸ”„ Reiniciar App</button>
                        <button class="btn-primary" onclick="rebuildContainers()">ğŸ”¨ Rebuild Containers</button>
                        <button class="btn-danger" onclick="pruneDocker()">ğŸ—‘ï¸ Limpar Docker</button>
                    </div>

                    <h3 style="margin-top: 20px;">ğŸ“‹ InformaÃ§Ãµes do Sistema</h3>
                    <button class="btn-info" onclick="getSystemInfo()">â„¹ï¸ Info do Sistema</button>
                    <textarea id="system-info" readonly placeholder="InformaÃ§Ãµes..."></textarea>
                </div>

                <div class="card full-width">
                    <h2>ğŸ§ª Testes de Performance</h2>
                    <div class="button-group">
                        <button class="btn-info" onclick="testLatency()">â±ï¸ Teste de LatÃªncia</button>
                        <button class="btn-info" onclick="testThroughput()">ğŸ“Š Teste de Throughput</button>
                        <button class="btn-info" onclick="testConcurrency()">ğŸ”€ Teste ConcorrÃªncia</button>
                    </div>
                    <textarea id="test-results" readonly placeholder="Resultados dos testes..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ESTADO GLOBAL =====
        let token = '';
        let uploadData = {};
        let ws = null;
        let currentPresence = 'offline';
        let messages = [];

        // ===== FUNÃ‡Ã•ES AUXILIARES =====
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = { method, headers: { 'Content-Type': 'application/json' } };
                if (body) options.body = JSON.stringify(body);
                const response = await fetch(`http://localhost:3333${endpoint}`, options);
                return await response.json();
            } catch (err) {
                return { success: false, error: err.message };
            }
        }

        function showAlert(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.className = `alert alert-${type}`;
            el.textContent = message;
            setTimeout(() => { el.className = ''; }, 5000);
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                let r = Math.random() * 16 | 0;
                let v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ===== INFRASTRUCTURE FUNCTIONS =====
        async function getDockerStatus() {
            const result = await apiCall('/api/docker/status');
            if (result.success) {
                const statusDiv = document.getElementById('docker-status');
                statusDiv.innerHTML = result.containers.map(c => `
                    <div class="status-item">
                        <strong>${c.name}</strong>
                        <span class="status-badge ${c.status.includes('Up') ? 'status-running' : 'status-stopped'}">
                            ${c.status}
                        </span>
                    </div>
                `).join('');
                showAlert('alert-docker', 'âœ… Status atualizado', 'success');
            } else {
                showAlert('alert-docker', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function startContainers() {
            showAlert('alert-docker', 'â³ Iniciando containers...', 'info');
            const result = await apiCall('/api/docker/start', 'POST');
            if (result.success) {
                showAlert('alert-docker', 'âœ… Containers iniciados! (aguarde ~60s)', 'success');
                setTimeout(getDockerStatus, 60000);
            } else {
                showAlert('alert-docker', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function stopContainers() {
            showAlert('alert-docker', 'â³ Parando containers...', 'info');
            const result = await apiCall('/api/docker/stop', 'POST');
            if (result.success) {
                showAlert('alert-docker', 'âœ… Containers parados', 'success');
                setTimeout(getDockerStatus, 2000);
            } else {
                showAlert('alert-docker', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function checkKafka() {
            showAlert('alert-kafka', 'â³ Verificando Kafka...', 'info');
            const result = await apiCall('/api/health/kafka');
            if (result.success) {
                document.getElementById('kafka-status').value = JSON.stringify(result.data, null, 2);
                showAlert('alert-kafka', 'âœ… Kafka estÃ¡ saudÃ¡vel', 'success');
            } else {
                document.getElementById('kafka-status').value = 'Erro: ' + result.error;
                showAlert('alert-kafka', 'âŒ Kafka com problemas', 'error');
            }
        }

        async function listKafkaTopics() {
            const result = await apiCall('/api/kafka/topics');
            if (result.success) {
                document.getElementById('kafka-status').value = JSON.stringify(result.topics, null, 2);
            }
        }

        async function checkRedis() {
            showAlert('alert-redis', 'â³ Verificando Redis...', 'info');
            const result = await apiCall('/api/health/redis');
            if (result.success) {
                document.getElementById('redis-status').value = 'Status: Conectado\n' + JSON.stringify(result.data, null, 2);
                showAlert('alert-redis', 'âœ… Redis estÃ¡ saudÃ¡vel', 'success');
            } else {
                document.getElementById('redis-status').value = 'Erro: ' + result.error;
                showAlert('alert-redis', 'âŒ Redis com problemas', 'error');
            }
        }

        async function getRedisInfo() {
            const result = await apiCall('/api/redis/info');
            if (result.success) {
                document.getElementById('redis-status').value = result.info;
            }
        }

        async function checkDatabase() {
            showAlert('alert-database', 'â³ Verificando PostgreSQL...', 'info');
            const result = await apiCall('/api/health/database');
            if (result.success) {
                document.getElementById('database-status').value = 'Status: Conectado\n' + JSON.stringify(result.data, null, 2);
                showAlert('alert-database', 'âœ… PostgreSQL estÃ¡ saudÃ¡vel', 'success');
            } else {
                document.getElementById('database-status').value = 'Erro: ' + result.error;
                showAlert('alert-database', 'âŒ PostgreSQL com problemas', 'error');
            }
        }

        async function getDatabaseInfo() {
            const result = await apiCall('/api/database/info');
            if (result.success) {
                document.getElementById('database-status').value = result.info;
            }
        }

        // ===== AUTH FUNCTIONS =====
        async function registerUser() {
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const passwordConfirm = document.getElementById('reg-password-confirm').value;

            if (password !== passwordConfirm) {
                showAlert('alert-auth', 'âŒ Senhas nÃ£o conferem', 'error');
                return;
            }

            const result = await apiCall('/api/platform/register', 'POST', { username, email, password });
            if (result.success) {
                showAlert('alert-auth', `âœ… UsuÃ¡rio registrado: ${result.data.username}`, 'success');
            } else {
                showAlert('alert-auth', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function loginUser() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const result = await apiCall('/api/platform/login', 'POST', { username, password });
            if (result.success) {
                token = result.data.token;
                document.getElementById('token-display').value = token;
                showAlert('alert-auth', 'âœ… Login realizado!', 'success');
            } else {
                showAlert('alert-auth', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        function logoutUser() {
            token = '';
            document.getElementById('token-display').value = '';
            showAlert('alert-auth', 'âœ… Logout realizado', 'success');
        }

        function copyToken() {
            const token = document.getElementById('token-display').value;
            if (token) {
                navigator.clipboard.writeText(token);
                showAlert('alert-auth', 'ğŸ“‹ Token copiado!', 'success');
            }
        }

        async function validateToken() {
            if (!token) {
                showAlert('alert-auth', 'âŒ Nenhum token', 'error');
                return;
            }
            const result = await apiCall('/api/platform/validate-token', 'POST', { token });
            const resultText = result.success ? 'âœ… Token vÃ¡lido!' : 'âŒ Token invÃ¡lido';
            document.getElementById('token-validation').value = resultText + '\n\n' + JSON.stringify(result.data || result.error, null, 2);
        }

        // ===== MESSAGING FUNCTIONS =====
        function generateConversationId() {
            const id = generateUUID();
            document.getElementById('msg-conversation-id').value = id;
            showAlert('alert-messaging', `âœ… ID gerado: ${id}`, 'success');
        }

        async function sendMessage() {
            if (!token) {
                showAlert('alert-messaging', 'âŒ FaÃ§a login primeiro!', 'error');
                return;
            }

            const conversationId = document.getElementById('msg-conversation-id').value;
            const messageContent = document.getElementById('msg-content').value;
            const messageType = document.getElementById('msg-type').value;

            if (!conversationId || !messageContent) {
                showAlert('alert-messaging', 'âŒ Preencha conversa ID e mensagem!', 'error');
                return;
            }

            const result = await apiCall('/api/platform/messages/send', 'POST', {
                conversationId,
                payload: { type: messageType, text: messageContent },
                token
            });

            if (result.success) {
                messages.push({ type: 'sent', content: messageContent, timestamp: new Date().toLocaleTimeString() });
                updateMessageThread();
                document.getElementById('msg-content').value = '';
                showAlert('alert-messaging', 'âœ… Mensagem enviada!', 'success');
            } else {
                showAlert('alert-messaging', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        function updateMessageThread() {
            const thread = document.getElementById('message-thread');
            thread.innerHTML = messages.map(msg => `
                <div class="message ${msg.type}">
                    <strong>${msg.type === 'sent' ? 'ğŸ“¤ Enviado' : 'ğŸ“¥ Recebido'}:</strong> ${msg.content}
                    <br><small>${msg.timestamp}</small>
                </div>
            `).join('');
            thread.scrollTop = thread.scrollHeight;
        }

        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8080/ws/connect');
                ws.onopen = () => {
                    updateWebSocketStatus(true);
                    showAlert('alert-messaging', 'âœ… WebSocket conectado!', 'success');
                };
                ws.onmessage = (event) => {
                    messages.push({ type: 'received', content: event.data, timestamp: new Date().toLocaleTimeString() });
                    updateMessageThread();
                };
                ws.onerror = (error) => {
                    showAlert('alert-messaging', 'âŒ Erro WebSocket: ' + error, 'error');
                };
                ws.onclose = () => {
                    updateWebSocketStatus(false);
                };
            } catch (err) {
                showAlert('alert-messaging', 'âŒ Erro: ' + err.message, 'error');
            }
        }

        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                updateWebSocketStatus(false);
                showAlert('alert-messaging', 'âœ… WebSocket desconectado', 'success');
            }
        }

        function updateWebSocketStatus(connected) {
            const status = document.getElementById('ws-status');
            if (connected) {
                status.textContent = 'Conectado';
                status.className = 'status-badge status-online';
            } else {
                status.textContent = 'Desconectado';
                status.className = 'status-badge status-stopped';
            }
        }

        // ===== PRESENCE FUNCTIONS =====
        async function goOnline() {
            if (!token) {
                showAlert('alert-presence', 'âŒ FaÃ§a login primeiro!', 'error');
                return;
            }
            const result = await apiCall('/api/presence/online', 'POST', { token });
            if (result.success) {
                currentPresence = 'online';
                document.getElementById('my-presence').textContent = 'ğŸŸ¢ Online';
                document.getElementById('my-presence').className = 'status-badge status-online';
                showAlert('alert-presence', 'âœ… Status: Online', 'success');
            } else {
                showAlert('alert-presence', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function goOffline() {
            const result = await apiCall('/api/presence/offline', 'POST', { token });
            if (result.success) {
                currentPresence = 'offline';
                document.getElementById('my-presence').textContent = 'ğŸ”´ Offline';
                document.getElementById('my-presence').className = 'status-badge status-stopped';
                showAlert('alert-presence', 'âœ… Status: Offline', 'success');
            } else {
                showAlert('alert-presence', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function checkUserPresence() {
            const userId = document.getElementById('presence-user-id').value;
            if (!userId) {
                showAlert('alert-presence', 'âŒ Preencha ID do usuÃ¡rio', 'error');
                return;
            }
            const result = await apiCall('/api/presence/check/' + userId);
            if (result.success) {
                const status = result.data.online ? 'ğŸŸ¢ Online' : 'ğŸ”´ Offline';
                document.getElementById('presence-result').value = `Status: ${status}\nÃšltima atividade: ${result.data.lastActivity || 'N/A'}`;
            } else {
                document.getElementById('presence-result').value = 'Erro: ' + result.error;
            }
        }

        async function getOnlineUsers() {
            const result = await apiCall('/api/presence/online-users');
            if (result.success) {
                const users = document.getElementById('online-users');
                users.innerHTML = result.data.map(user => `
                    <div class="status-item">
                        <strong>${user.username}</strong>
                        <span class="status-badge status-online">ğŸŸ¢ Online</span>
                    </div>
                `).join('');
            }
        }

        // ===== STORAGE FUNCTIONS =====
        async function initiateUpload() {
            if (!token) {
                showAlert('alert-storage', 'âŒ FaÃ§a login primeiro!', 'error');
                return;
            }
            const filename = document.getElementById('upload-filename').value;
            const mimeType = document.getElementById('upload-mimetype').value;
            const fileSize = document.getElementById('upload-content').value.length;

            const result = await apiCall('/api/platform/upload/initiate', 'POST', { filename, mimeType, fileSize, token });
            if (result.success) {
                uploadData = result.data;
                document.getElementById('upload-result').value = JSON.stringify(uploadData, null, 2);
                showAlert('alert-storage', 'âœ… Upload iniciado!', 'success');
            } else {
                showAlert('alert-storage', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function uploadFile() {
            if (!uploadData.presignedUrls) {
                showAlert('alert-storage', 'âŒ Inicie o upload primeiro!', 'error');
                return;
            }
            const content = document.getElementById('upload-content').value;
            const result = await apiCall('/api/platform/upload/file', 'POST', { presignedUrl: uploadData.presignedUrls[0], content });
            if (result.success) {
                uploadData.eTag = result.eTag;
                document.getElementById('upload-result').value = `ETag: ${result.eTag}\n\n${result.output}`;
                showAlert('alert-storage', 'âœ… Arquivo enviado!', 'success');
            } else {
                showAlert('alert-storage', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function completeUpload() {
            if (!uploadData.attachmentId || !uploadData.eTag) {
                showAlert('alert-storage', 'âŒ Complete os passos anteriores!', 'error');
                return;
            }
            const result = await apiCall('/api/platform/upload/complete', 'POST', { attachmentId: uploadData.attachmentId, eTag: uploadData.eTag, token });
            if (result.success) {
                document.getElementById('upload-result').value = 'âœ… Upload completado!\n\n' + result.output;
                showAlert('alert-storage', 'âœ… Arquivo armazenado!', 'success');
                uploadData = {};
            } else {
                showAlert('alert-storage', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function listBuckets() {
            const result = await apiCall('/api/storage/buckets');
            if (result.success) {
                document.getElementById('upload-result').value = JSON.stringify(result.buckets, null, 2);
            }
        }

        // ===== TELEGRAM FUNCTIONS =====
        async function saveTelegramConfig() {
            const token = document.getElementById('telegram-token').value;
            const chatId = document.getElementById('telegram-chat-id').value;
            const result = await apiCall('/api/telegram/config', 'POST', { token, chatId });
            if (result.success) {
                showAlert('alert-telegram', 'âœ… ConfiguraÃ§Ã£o salva!', 'success');
            } else {
                showAlert('alert-telegram', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function sendTelegramMessage() {
            const message = document.getElementById('telegram-message').value;
            const result = await apiCall('/api/telegram/send', 'POST', { message });
            if (result.success) {
                document.getElementById('telegram-messages').innerHTML += `<div class="message sent">ğŸ“¤ ${message}</div>`;
                document.getElementById('telegram-message').value = '';
                showAlert('alert-telegram', 'âœ… Mensagem enviada!', 'success');
            } else {
                showAlert('alert-telegram', 'âŒ Erro: ' + result.error, 'error');
            }
        }

        async function testTelegramConnection() {
            const result = await apiCall('/api/telegram/test');
            document.getElementById('telegram-status').value = result.success ? 'âœ… ConexÃ£o OK' : 'âŒ Erro: ' + result.error;
        }

        async function startTelegramListener() {
            showAlert('alert-telegram', 'ğŸ‘‚ Listener iniciado...', 'info');
        }

        async function stopTelegramListener() {
            showAlert('alert-telegram', 'â¹ï¸ Listener parado', 'info');
        }

        // ===== MONITORING FUNCTIONS =====
        async function getPrometheusMetrics() {
            const result = await apiCall('/api/metrics/prometheus');
            if (result.success) {
                document.getElementById('prometheus-metrics').value = result.metrics;
            }
        }

        async function getGrafanaHealth() {
            const result = await apiCall('/api/metrics/grafana-health');
            document.getElementById('grafana-status').value = JSON.stringify(result.data || result.error, null, 2);
        }

        async function getApplicationMetrics() {
            const result = await apiCall('/api/metrics/app');
            if (result.success) {
                const metricsDiv = document.getElementById('app-metrics');
                metricsDiv.innerHTML = Object.entries(result.data).map(([key, value]) => `
                    <div class="metric">
                        <div class="metric-value">${value}</div>
                        <div class="metric-label">${key}</div>
                    </div>
                `).join('');
            }
        }

        // ===== ADVANCED FUNCTIONS =====
        async function getLogs(lines = 50) {
            const logsDiv = document.getElementById('logs-display');
            logsDiv.innerHTML = '<span class="spinner"></span> Carregando logs...';
            const result = await apiCall(`/api/docker/logs?lines=${lines}`);
            if (result.success) {
                logsDiv.textContent = result.logs;
                logsDiv.scrollTop = logsDiv.scrollHeight;
            } else {
                logsDiv.textContent = `Erro: ${result.error}`;
            }
        }

        async function restartApp() {
            showAlert('alert-storage', 'â³ Reiniciando aplicaÃ§Ã£o...', 'info');
            const result = await apiCall('/api/admin/restart', 'POST');
            if (result.success) {
                showAlert('alert-storage', 'âœ… AplicaÃ§Ã£o reiniciada!', 'success');
            }
        }

        async function rebuildContainers() {
            showAlert('alert-storage', 'â³ Rebuilding containers...', 'info');
            const result = await apiCall('/api/docker/rebuild', 'POST');
            if (result.success) {
                showAlert('alert-storage', 'âœ… Rebuild completo!', 'success');
            }
        }

        async function pruneDocker() {
            if (confirm('Tem certeza? Isto deletarÃ¡ containers e imagens nÃ£o usados.')) {
                const result = await apiCall('/api/docker/prune', 'POST');
                if (result.success) {
                    showAlert('alert-storage', 'âœ… Docker limpado!', 'success');
                }
            }
        }

        async function getSystemInfo() {
            const result = await apiCall('/api/system/info');
            if (result.success) {
                document.getElementById('system-info').value = JSON.stringify(result.data, null, 2);
            }
        }

        async function testLatency() {
            const start = Date.now();
            const result = await apiCall('/api/test/ping');
            const latency = Date.now() - start;
            document.getElementById('test-results').value = `â±ï¸ LatÃªncia: ${latency}ms\n\nResultado: ${JSON.stringify(result, null, 2)}`;
        }

        async function testThroughput() {
            showAlert('alert-storage', 'ğŸ“Š Testando throughput...', 'info');
            const result = await apiCall('/api/test/throughput', 'POST');
            if (result.success) {
                document.getElementById('test-results').value = `ğŸ“Š Throughput: ${result.data}\n\n${result.details}`;
            }
        }

        async function testConcurrency() {
            showAlert('alert-storage', 'ğŸ”€ Testando concorrÃªncia...', 'info');
            const result = await apiCall('/api/test/concurrency', 'POST');
            if (result.success) {
                document.getElementById('test-results').value = `ğŸ”€ ConcorrÃªncia: ${result.data}\n\n${result.details}`;
            }
        }

        // ===== INICIALIZAR =====
        window.addEventListener('load', () => {
            getDockerStatus();
        });
    </script>
</body>
</html>
